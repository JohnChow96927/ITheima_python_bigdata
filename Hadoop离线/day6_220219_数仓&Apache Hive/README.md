# 数据仓库与Apache Hive

## I. 数据仓库

1. ### 数据仓库的基本概念

   ##### 数据仓库(Data Warehouse, 数仓, DW)是一个用于存储, **分析**, 报告的数据系统.

   ##### 数据仓库的目的是构建面向分析的集成化数据环境, 分析结果为企业提供决策支持.

   ##### 数据仓库本身并不"生产"任何数据, 也不"消费"任何数据, 数据来源于外部且开放给外部应用.

   消费数据: 分析完的结果并不是数仓自己使用, 而是开放给其他应用使用.

   ![1645237719976](assets/1645237719976.png)

   数据源(业务数据, 友商数据等等)------>**数据仓库**------>数据**分析**

   联机事务处理系统(**OLTP**)的基本特征是前台接收的用户数据可以立即传送到后台进行处理, 并在很短的时间内给出处理结果, **关系型数据库(RDBMS)**是OLTP典型的应用(Oracle, MySQL, SQL Server...)

   联机分析处理系统(**OLAP**)是面向分析, 支持分析的系统, 数据仓库是OLAP的一种

2. ### 数据仓库的主要特征

   1. #### 面向主题(Sub-Oriented)

      数据仓库是面向主题的, **主题是一个抽象的概念, 是较高层次上企业信息系统中的数据综合, 归类并进行分析利用的抽象**. 在逻辑意义上, 它是对应企业中某一宏观分析领域所涉及的分析对象.

      对于保险公司, 主题可以是"**客户**", "**保险理赔**", "**承保**"等等.

   2. #### 集成性(Integrated)

      一个主题可能横跨多个数据源, 这些数据源之间可以能存在差异, 如字段的同名异义、异名同义、单位不统一、字长不一致等等, 集成就是在数据进入数据仓库之前必须要经过的**统一与综合，抽取、清理、转换和汇总**操作, 这是数据仓库建设中**最关键, 最复杂**的一步. 

      ETL: 抽取/转换/加载

   3. #### 非易失性(不可更新性)(Non-Volatile)

      - **数据仓库是分析数据的平台, 而不是创造数据的平台**,数据进入数据仓库后, 便稳定且不会改变(规律不能修改)
      - 数据仓库中只要保存过去的业务数据, 不需要每一笔业务都实时更新数据仓库, 而是根据商业需要每隔一段时间把一批较新的数据导入数据仓库
      - **数据仓库的数据反应的是一段相当长的时间内历史数据的内容**
      - **数据仓库中一般有大量的查询操作, 但修改和删除操作很少**

   4. #### 时变性(Time-Variant)

      **数据仓库的数据需要随着时间更新, 以适应决策的需要**.

      T+1, T+7, T+30

      - 数据仓库包含各种粒度的历史数据，数据可能与某个特定日期、星期、月份、季度或者年份有关。

      - 虽然数据仓库的用户不能修改数据，但并不是说数据仓库的数据是永远不变的。分析的结果只能反映过去的情况，当业务变化后，挖掘出的模式会失去时效性。因此数据仓库的数据需要随着时间更新，以适应决策的需要。从这个角度讲，数据仓库建设是一个项目，更是一个过程 。

      - 数据仓库的数据随时间的变化表现在以下几个方面。
        - 数据仓库的数据时限一般要远远长于操作型数据的数据时限。
        - 操作型系统存储的是当前数据，而数据仓库中的数据是历史数据。
        - 数据仓库中的数据是按照时间顺序追加的，它们都带有时间属性。

3. ### 数据仓库与数据库的区别

   #### OLTP与OLAP

   - 联机**事务**处理 OLTP（On-Line **Transaction** Processing）。**数据库**属于这里, 主要目标是做数据处理, 用户较为关心操作的响应时间, 数据的安全性, 完整性和并发支持的用户数等问题

   - 联机**分析**处理 OLAP（On-Line **Analytical** Processing）。**数据仓库**属于这里, 主要目标是做数据分析, 一般针对某些**主题**的**历史数据**进行复杂的多维分析, 支持管理决策.

   ![1645240426362](assets/1645240426362.png)

   |              | **OLTP**                     | **OLAP**                                        |
   | ------------ | ---------------------------- | ----------------------------------------------- |
   | **数据源**   | 仅包含当前运行日常业务数据   | 整合来自多个来源的数据，包括OLTP和外部来源      |
   | **目的**     | 面向应用，面向业务，支撑事务 | 面向主题，面向分析，支撑分析决策                |
   | **焦点**     | 当下                         | 主要面向过去、面向历史  实时数仓除外            |
   | **任务**     | 读写操作                     | 大量读而很少写操作                              |
   | **响应时间** | 毫秒                         | 秒、分钟、小时或者天   取决于数据量和查询复杂性 |
   | **数据量**   | 小数据，MB,GB                | 大数据，TP，PB                                  |

   ![1645241188069](assets/1645241188069.png)

   #### **数据仓库与数据库的区别**:

   - ##### 数据仓库不是大型的数据库，虽然数据仓库存储数据规模大。

   - ##### 数据仓库的出现，并不是要取代数据库。

   - ##### 数据库是面向事务的设计，数据仓库是面向主题设计的。

   - ##### 数据库一般存储业务数据，数据仓库存储的一般是历史数据。

   - ##### 数据库是为捕获数据而设计，数据仓库是为分析数据而设计。

   #### 数据仓库, 数据集市

   - ##### 下图中，各种操作型系统数据和包括文件在内的等其他数据作为数据源，经过ETL(抽取转换加载)填充到数据仓库中；数据仓库中有不同主题数据，数据集市则根据部门特点面向指定主题，比如Purchasing（采购）、Sales（销售）、Inventory（库存）；

   - ##### 用户可以基于主题数据开展各种应用：数据分析、数据报表、数据挖掘。

   ![1645241350565](assets/1645241350565.png)

4. ### 数据仓库分层架构

   #### 数仓分层的好处: 

   - **清晰数据结构**: 每个数据分层都有其作用域, 使用表的时候能更方便地定位和理解
   - **数据血缘追踪**: 当数据来源表出问题的时候能快速定位到问题并清楚其危害范围
   - **减少重复开发**: 方便开发通用的中间层数据, 可以减少极大的重复计算
   - **把复杂问题简单化**: 每一层只处理单一的步骤, 比较简单和容易理解, 且便于维护数据的准确性, 出现问题时只需要从有问题的步骤开始修复
   - **屏蔽原始数据的异常**: 屏蔽业务的影响, 不必改一次业务就重新接入数据

   #### 分层思想和标准:

   - **按照数据流入流出数仓的过程进行分层**显得水到渠成, 因为数仓不产生数据, 也不消费数据
   - 最基础的分层思想, 理论上分为三个层: 操作型数据层(**O**peration **D**ata **S**tore), 数据仓库层(**DW**), 数据应用层(**DA**)

   ![1645241459659](assets/1645241459659.png)

   #### 阿里数仓3层架构(ODS, DW, DA)

   ![1645241791190](assets/1645241791190.png)

   ##### ODS层:

   - **操作型数据层**，也称之为源数据层、数据引入层、数据暂存层、临时缓存层。

   - ##### 此层存放未经过处理的原始数据至数据仓库系统，结构上与源系统保持一致，是数据仓库的数据准备区。

   - 主要完成基础数据引入到数仓的职责，和数据源系统进行解耦合，同时记录基础数据的历史变化。

   ##### DW层:

   - **数据仓库层**，由ODS层数据加工而成。主要完成数据加工与整合，建立一致性的维度，构建可复用的面向分析和统计的明细事实表，以及汇总公共粒度的指标。内部具体划分如下：
     - 公共维度层（DIM）：基于维度建模理念思想，建立整个企业一致性维度。
     - 公共汇总粒度事实层（DWS、DWB）：以分析的主题对象作为建模驱动，基于上层的应用和产品的指标需求，构建公共粒度的汇总指标事实表，以宽表化手段物理化模型
     - 明细粒度事实层（DWD）: 将明细事实表的某些重要维度属性字段做适当冗余，即宽表化处理。

   ##### DA层:

   - 数据应用层, 面向最终用户, 面向业务定制提供给产品和数据分析使用的数据
   - 包括前端报表, 分析图表, KPI, 仪表盘, OLAP专题, 数据挖掘等分析

5. ### ETL与ELT

   1. #### ETL

      

   2. #### ELT

      

## II. Apache Hive

1. ### Hive简介

   1. #### 什么是Hive

      

   2. #### 为什么使用Hive

      

2. ### Hive架构

   1. #### Hive架构图

      

   2. #### Hive组件

      

   3. #### Hive与Hadoop的关系

      

3. ### Hive与传统数据库对比

   

## III. Hive安装部署

1. ### metadata与metastore

   

2. ### metastore三种配置方式

   1. #### 内嵌模式

      

   2. #### 本地模式

      

   3. #### 远程模式

      

3. ### Hive metastore远程模式与安装部署

   1. #### Hadoop中添加用户代理配置

      

   2. #### 上传安装包并解压

      

   3. #### 修改配置文件hive-env.sh

      

   4. #### 添加配置文件hive-site.xml

      

   5. #### 上传MySQL驱动

      

   6. #### 初始化元数据

      

   7. #### 创建hive存储目录

      

4. ### metastore的启动方式

   

5. ### Hive Client与Beeline Client

   1. #### 第一代客户端Hive Client

      

   2. #### 第二代客户端Hive Beeline Client

      

