# DWB层建设实战、Presto计算引擎

## I. DWB层构建

### 1. DWB功能职责

- 新零售数仓分层图

  ![image-20211011134501462](../../../../Users/JohnChow/Desktop/%E6%96%B0%E9%9B%B6%E5%94%AEday05--%E7%AC%94%E8%AE%B0+%E6%80%BB%E7%BB%93/Day05_DWB%E5%B1%82%E5%BB%BA%E8%AE%BE%E5%AE%9E%E6%88%98%E3%80%81Presto%E8%AE%A1%E7%AE%97%E5%BC%95%E6%93%8E.assets/image-20211011134501462.png)

- DWB

  - 名称：基础数据层、中间数据层
  - 功能：==退化维度（降维）==形成大宽表

### 2. 维度退化(降维)概念与意义

- 百科定义

  > 退化维度（Degenerate Dimension,DD），就是那些看起来像是事实表的一个维度关键字，但实际上并没有对应的维度表。
  >
  > ==退化维度技术可以减少维度的数量（降维操作）==，简化维度数据仓库的模式。简单的模式比复杂的更容易理解，也有更好的查询性能。

  ![image-20211011134757903](assets/image-20211011134757903.png)

- 常见操作

  > 1、将==各个维度表的核心字段数据汇总到事实表==中；
  >
  > 2、如果一个业务模块有多个事实表，也可以将==多个事实表的核心字段汇总到一个事实表==。

- 功能

  - 通过退化维度操作之后，带来的显著效果是
    - 整个数仓中**表的个数减少**了；
    - 业务==相关联的数据==（跟你分析相关的）数据字段聚在一起了，==形成一张宽表==。
    - 分析==查询时的效率显著提高==了：多表查询和==单表查询==的差异。
  - 带来的坏处是
    - 数据大量冗余、宽表的概念已经不符合3范式设计要求了。
    - 但是数仓建模的核心追求是，只要有利于分析，能够加快数据分析，都可以做。

- 新零售项目--DWB层明细宽表

  > 根据业务形式和后续分析需求，划分了3大模块，对应着3张明细宽表。
  >
  > 用户业务模块没有进行退化维度操作，原因是后面的指标单表可以操作技术。

  - 订单明细宽表 **==dwb_order_detail==**
  - 店铺明细宽表 **==dwb_shop_detail==**
  - 商品明细宽表 **==dwb_goods_detail==**

- 使用DataGrip在Hive中创建dwb层

  ```sql
  create database if not exists yp_dwb;
  ```

  ![image-20211011145558382](assets/image-20211011145558382.png)

### 3. 订单明细宽表构建



### 4. 店铺明细宽表构建



#### 4.1. 省市县3级查询思路与实现



### 5. 商品明细宽表构建



## II. 分布式SQL引擎Presto

### 1. 介绍, 架构, 名词术语含义



### 2. 集群安装, 启停



### 3. 客户端的使用(命令行, DataGrip集成)



### 4. Presto时间日期类型使用注意事项



### 5. Presto优化

#### 5.1. 常规优化



#### 5.2. 内存优化

