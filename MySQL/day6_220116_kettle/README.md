# Kettle

## I. 可视化ETL平台 - Kettle

### E: Extract 抽取

### T: Transform 转换

### L: Load 装载

1. ### Kettle简介和安装

    ##### Kettle是一款国外开源的ETL工具

    - 纯Java开发
    - 用于数据库间的数据迁移
    - 多平台运行
    - 有图形界面, 有命令脚本, 可以二次开发
    - Kettle即水壶, 将数据放在壶里, 然后以一种指定的格式流出

    ##### Kettle环境的搭建:

    - 安装Java jdk环境(配置环境变量, 具体方法面向百度)
    - 解压Kettle软件(根据操作系统面向百度)

2. ### Kettle数据转换

    ##### 在开发中, 数据不是单一形式的, Kettle为我们提供了可靠的可视化转换形式, 其可以再多种数据源之间进行快速转换

    > ##### Kettle的基本开发步骤:
    >
    > - ##### 新建转换
    >
    > - ##### 构建Kettle数据流图
    >
    > - ##### 配置数据流图中的各个组件
    >
    > - ##### 保存并启动执行

    1. #### txt转Excel

        - kettle的基本开发步骤:

            1. 新建转换

            2. 构建kettle数据流图

                数据从哪来, 数据到哪去, 按住shift拉线连接输入输出

            3. 配置数据流图中的各个组件

                - 选择输入文件, 添加, 选择编码方式, 更改内容分隔符, 获取并检查字段, 预览结果
                - 选择输出文件地址, 获取字段, 检查字段属性

            4. 保存并启动执行

    2. #### Excel转MySQL

        - 复制MySQL jdbc驱动包到lib文件夹
        - 在JNDI文件夹下配置MYSQL_DB连接
        - 配置数据流图各组件
        - 保存并启动执行

    3. #### MySQL表间转换

        共享数据库连接

        - 新建转换
        - 构建数据流图
        - 配置数据流图各组件
        - 保存并启动执行

3. ### 插入和更新组件

    

4. ### switch-case组件

    

5. ### SQL脚本组件

    

6. ### 设置转换参数

    

7. ### 作业(job)开发

    

8. ### 销售数据案例

    #### 需求: 将零售门店销售数据同步到总公司的服务器中

    ##### 该门店数据记录在excel中，需要定期将数据写入数据库，且该门店可能会对前一天的数据进行校验修改，同步数据的准则：

    - ##### 如果该订单已存在, 就修改其订单内容.

    - ##### 如果该订单不存在, 则新增订单.

    ##### 同步周期为一天一次, 同步时间为晚上12点, 不影响公司正常销售.

    ###### 需求抽取: 

    1. 将Excel中的数据同步到MySQL数据库中
    2. 定期同步数据
    3. 同步数据时如果订单存在就更新, 如果订单不存在就新增

    ##### 运用知识与需求实现:

    1. 创建转换: 文件 —> 新建 —> 转换
        - 输入: Excel输入组件
        - 输出: 插入/更新组件
    2. 创建作业
        - 定时循环启动
        - 添加转换组件
        - 添加成功组件























