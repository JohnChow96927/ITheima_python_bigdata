![1](imgs/1.png)

![2](imgs/2.png)

![3](imgs/3.png)

![4](imgs/4.png)

1. ## 窗口函数

    ##### 1. COUNT练习:

    ```mysql
    SELECT name     `顾客`,
           COUNT(*) `购买次数`
    FROM business
    WHERE MONTH(orderdate) = 4
    GROUP BY name;
    ```

    ##### 2. SUM练习:

    ```mysql
    -- 2.1. 查询每个顾客每个月购买总额明细
    SELECT DISTINCT name `顾客`,
           MONTH(orderdate) `月份`,
           SUM(cost) OVER (PARTITION BY MONTH(orderdate), name) `购买总额`
    FROM business;
    
    -- 2.2. 查询每个顾客到目前为止的购买总金额明细
    SELECT DISTINCT name `顾客`,
                    SUM(cost) OVER (PARTITION BY name) `购买总金额`
    FROM business;
    ```

    ##### 3. LAG练习:

    ```mysql
    -- 3. 查询顾客上次的购买时间
    SELECT DISTINCT name `顾客`,
                    orderdate `此次购买时间`,
                    LAG(orderdate) over (PARTITION BY name ORDER BY orderdate) `上次购买时间`
    FROM business;
    ```

    ##### 4. NTILE练习:

    ```mysql
    -- 4. 查询前20%时间的订单信息
    WITH temp_tb AS (SELECT *,
                            NTILE(5) over (ORDER BY orderdate) `N`
                     FROM business
    )
    SELECT name,
           orderdate,
           cost
    FROM temp_tb
    WHERE N = 1;
    ```

2. ## 连续活跃问题

    

3. ## MySQL日期函数

    1. 使用LAST_DAY函数找出今年2月的最后一天

        ```mysql
        SELECT LAST_DAY('2022-02-01');
        ```

        

    2. 希望知道ALLEN和WARD的HIREDATE相差多少天

        ```mysql
        SELECT DATEDIFF(a.date, b.date)
        FROM T1 a
        JOIN T1 b
        WHERE a.name = 'ALLEN' AND b.name = 'WARD';
        ```

        